/*
   –ì–õ–ê–í–ù–´–ô –§–ê–ô–õ –ö–ê–†–¢–´
   
   –ß—Ç–æ —Ç–∞–∫–æ–µ JavaScript?
   - –≠—Ç–æ —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π
   - –û–Ω –º–æ–∂–µ—Ç —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–ª–∏–∫–∏, –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –∏–∑–º–µ–Ω—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
   
   –ß—Ç–æ —Ç–∞–∫–æ–µ –∫–ª–∞—Å—Å?
   - –ö–ª–∞—Å—Å - —ç—Ç–æ "—á–µ—Ä—Ç–µ–∂" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
   - –ù–∞–ø—Ä–∏–º–µ—Ä, –∫–ª–∞—Å—Å "–ú–∞—à–∏–Ω–∞" –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –º–∞—à–∏–Ω—ã (BMW, Audi, etc.)
   - –ù–∞—à –∫–ª–∞—Å—Å SatelliteMap —Å–æ–∑–¥–∞–µ—Ç –∫–∞—Ä—Ç—É —Å–æ –≤—Å–µ–º–∏ –µ—ë —Ñ—É–Ω–∫—Ü–∏—è–º–∏
*/

class SatelliteMap {
    // constructor - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞
    // –ó–¥–µ—Å—å –º—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º) –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    constructor(containerId, apiKey) {
        // this - —ç—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ–∫—É—â–∏–π –æ–±—ä–µ–∫—Ç
        // –ú—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Å–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–∞
        this.containerId = containerId;  // ID —ç–ª–µ–º–µ–Ω—Ç–∞, –≥–¥–µ –±—É–¥–µ—Ç –∫–∞—Ä—Ç–∞
        this.apiKey = apiKey;             // API –∫–ª—é—á –¥–ª—è MapTiler
        this.map = null;                  // –°–∞–º–∞ –∫–∞—Ä—Ç–∞ (–ø–æ–∫–∞ null, —Å–æ–∑–¥–∞–¥–∏–º –ø–æ–∑–∂–µ)
        this.currentZoom = 10;            // –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∑—É–º–∞
        this.currentCenter = [30.5234, 50.4501]; // –ö–∏–µ–≤ [longitude, latitude]
        this.layers = [];                 // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ª–æ–µ–≤
    }

    // –ú–µ—Ç–æ–¥ (—Ñ—É–Ω–∫—Ü–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞) –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã
    init() {
        try {
            console.log('üó∫Ô∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã...');

            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É —Å –ø–æ–º–æ—â—å—é MapTiler SDK
            this.map = new maptilersdk.Map({
                container: this.containerId,  // –ì–¥–µ –ø–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç—É
                apiKey: this.apiKey,           // API –∫–ª—é—á
                style: maptilersdk.MapStyle.SATELLITE, // –°–ø—É—Ç–Ω–∏–∫–æ–≤—ã–π —Å—Ç–∏–ª—å
                center: this.currentCenter,    // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
                zoom: this.currentZoom         // –ù–∞—á–∞–ª—å–Ω—ã–π –∑—É–º
            });

            // –ö–æ–≥–¥–∞ –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è, –≤—ã–ø–æ–ª–Ω–∏–º —ç—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è
            this.map.on('load', () => {
                console.log('‚úÖ –ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
                this.setupControls();  // –ù–∞—Å—Ç—Ä–æ–∏–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                this.setupEventListeners(); // –ù–∞—Å—Ç—Ä–æ–∏–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
            this.map.on('error', (e) => {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∫–∞—Ä—Ç—ã:', e);
            });

        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã:', error);
        }
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–∑—É–º)
    setupControls() {
        console.log('üéÆ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤...');

        // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫–∏ –≤ HTML –ø–æ –∏—Ö ID
        const zoomInBtn = document.getElementById('zoom-in');
        const zoomOutBtn = document.getElementById('zoom-out');

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É "+"
        // addEventListener - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è "—Å–ª—É—à–∞–µ—Ç" —Å–æ–±—ã—Ç–∏—è (–∫–ª–∏–∫–∏, –Ω–∞–≤–µ–¥–µ–Ω–∏—è –∏ —Ç.–¥.)
        zoomInBtn.addEventListener('click', () => {
            this.zoomIn(); // –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∑—É–º–∞
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É "-"
        zoomOutBtn.addEventListener('click', () => {
            this.zoomOut(); // –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ —É–º–µ–Ω—å—à–µ–Ω–∏—è –∑—É–º–∞
        });
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –∫–∞—Ä—Ç—ã
    setupEventListeners() {
        console.log('üëÇ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π...');

        // –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –∫–∞—Ä—Ç—É
        this.map.on('click', (e) => {
            // e.lngLat - —ç—Ç–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–ª–∏–∫–∞
            console.log('üìç –ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–µ:', e.lngLat);

            // –ü–æ–∑–∂–µ –∑–¥–µ—Å—å –±—É–¥–µ–º –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å popup —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
            // this.showPopup(e.lngLat);
        });

        // –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω—è–µ—Ç –∑—É–º (–∫–æ–ª–µ—Å–∏–∫–æ–º –º—ã—à–∏ –∏–ª–∏ –∫–Ω–æ–ø–∫–∞–º–∏)
        this.map.on('zoom', () => {
            this.currentZoom = this.map.getZoom();
            console.log('üîç –¢–µ–∫—É—â–∏–π –∑—É–º:', this.currentZoom.toFixed(2));
        });

        // –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–≤–∏–≥–∞–µ—Ç –∫–∞—Ä—Ç—É
        this.map.on('move', () => {
            this.currentCenter = this.map.getCenter();
            // console.log('üó∫Ô∏è –¢–µ–∫—É—â–∏–π —Ü–µ–Ω—Ç—Ä:', this.currentCenter);
        });
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∑—É–º–∞
    zoomIn() {
        console.log('‚ûï –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∑—É–º–∞');
        this.map.zoomIn(); // –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è MapTiler
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∑—É–º–∞
    zoomOut() {
        console.log('‚ûñ –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∑—É–º–∞');
        this.map.zoomOut(); // –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è MapTiler
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∫–∞—Ä—Ç—ã –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Ç–æ—á–∫–µ
    flyTo(coordinates, zoom = 12) {
        console.log('‚úàÔ∏è –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫:', coordinates);

        // flyTo - —ç—Ç–æ –∫—Ä–∞—Å–∏–≤–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
        this.map.flyTo({
            center: coordinates,  // –ö—É–¥–∞ –ª–µ—Ç–µ—Ç—å
            zoom: zoom,           // –° –∫–∞–∫–∏–º –∑—É–º–æ–º
            duration: 2000        // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        });
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –≥—Ä–∞–Ω–∏—Ü –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ –∫–∞—Ä—Ç—ã
    getBounds() {
        const bounds = this.map.getBounds();
        console.log('üìê –ì—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ä—Ç—ã:', bounds);
        return bounds;
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ–∫–∞–∑–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    showLoader() {
        const loader = document.getElementById('loader');
        loader.classList.remove('hidden'); // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å 'hidden'
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    hideLoader() {
        const loader = document.getElementById('loader');
        loader.classList.add('hidden'); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å 'hidden'
    }
}

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª–∞—Å—Å, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–∞—Ö
export default SatelliteMap;
